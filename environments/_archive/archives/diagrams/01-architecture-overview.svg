<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: 16px sans-serif; fill: #666; }
      .box { fill: #fff; stroke: #333; stroke-width: 2; }
      .s3-box { fill: #569A31; stroke: #3d6e23; stroke-width: 2; }
      .lambda-box { fill: #FF9900; stroke: #cc7a00; stroke-width: 2; }
      .glue-box { fill: #8C4FFF; stroke: #6b3acc; stroke-width: 2; }
      .dynamo-box { fill: #4053D6; stroke: #2d3a9a; stroke-width: 2; }
      .sqs-box { fill: #FF4F8B; stroke: #cc3f6f; stroke-width: 2; }
      .cloudwatch-box { fill: #FF4F8B; stroke: #cc3f6f; stroke-width: 2; }
      .text { font: 14px sans-serif; fill: #fff; text-anchor: middle; }
      .label { font: 12px sans-serif; fill: #333; text-anchor: middle; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-arrow { stroke: #0066cc; stroke-width: 3; fill: none; marker-end: url(#data-arrowhead); }
      .event-arrow { stroke: #cc6600; stroke-width: 2; stroke-dasharray: 5,5; fill: none; marker-end: url(#event-arrowhead); }
      .small-text { font: 11px sans-serif; fill: #666; }
      .metric-text { font: 10px sans-serif; fill: #999; }
      .section-title { font: bold 16px sans-serif; fill: #333; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="data-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#0066cc" />
    </marker>
    <marker id="event-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#cc6600" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" class="title" text-anchor="middle">NDJSON to Parquet Pipeline - Architecture Overview</text>
  <text x="700" y="55" class="subtitle" text-anchor="middle">Batch Processing Mode | 338K files/day @ 4GB each</text>

  <!-- Ingestion Layer -->
  <text x="70" y="100" class="section-title">Ingestion</text>

  <!-- S3 Input Bucket -->
  <rect x="50" y="120" width="180" height="100" class="s3-box" rx="5"/>
  <text x="140" y="150" class="text">S3 Input Bucket</text>
  <text x="140" y="170" class="small-text" fill="#fff">ndjson-input-sqs-*</text>
  <text x="140" y="190" class="metric-text" fill="#fff">338K files/day</text>
  <text x="140" y="205" class="metric-text" fill="#fff">3.5-4.5 GB each</text>

  <!-- S3 Event -->
  <rect x="280" y="140" width="120" height="60" class="box" rx="5"/>
  <text x="340" y="165" class="label">S3 Event</text>
  <text x="340" y="185" class="small-text">ObjectCreated</text>

  <!-- Arrow from S3 to Event -->
  <path d="M 230 170 L 280 170" class="event-arrow"/>

  <!-- SQS Queue -->
  <rect x="440" y="120" width="160" height="100" class="sqs-box" rx="5"/>
  <text x="520" y="150" class="text">SQS Queue</text>
  <text x="520" y="170" class="small-text" fill="#fff">file-events</text>
  <text x="520" y="190" class="metric-text" fill="#fff">Batch: 10 msgs</text>
  <text x="520" y="205" class="metric-text" fill="#fff">Visibility: 300s</text>

  <!-- Arrow from Event to SQS -->
  <path d="M 400 170 L 440 170" class="event-arrow"/>

  <!-- Processing Layer -->
  <text x="70" y="280" class="section-title">Processing</text>

  <!-- Lambda Manifest Builder -->
  <rect x="50" y="300" width="200" height="140" class="lambda-box" rx="5"/>
  <text x="150" y="330" class="text">Lambda Function</text>
  <text x="150" y="350" class="small-text" fill="#fff">manifest-builder</text>
  <text x="150" y="375" class="metric-text" fill="#fff">Memory: 1024 MB</text>
  <text x="150" y="390" class="metric-text" fill="#fff">Timeout: 300s</text>
  <text x="150" y="405" class="metric-text" fill="#fff">Batch: 100 files</text>
  <text x="150" y="420" class="metric-text" fill="#fff">Max Size: 500 GB</text>

  <!-- Arrow from SQS to Lambda -->
  <path d="M 520 220 L 520 260 L 150 260 L 150 300" class="event-arrow"/>
  <text x="280" y="255" class="small-text">Poll every 1 min</text>

  <!-- DynamoDB File Tracking -->
  <rect x="300" y="300" width="180" height="140" class="dynamo-box" rx="5"/>
  <text x="390" y="330" class="text">DynamoDB</text>
  <text x="390" y="350" class="small-text" fill="#fff">file-tracking</text>
  <text x="390" y="375" class="metric-text" fill="#fff">PK: date_prefix</text>
  <text x="390" y="390" class="metric-text" fill="#fff">SK: file_key</text>
  <text x="390" y="405" class="metric-text" fill="#fff">Status: pending→</text>
  <text x="390" y="420" class="metric-text" fill="#fff">manifested→completed</text>

  <!-- Arrow from Lambda to DynamoDB -->
  <path d="M 250 370 L 300 370" class="arrow"/>
  <text x="275" y="365" class="small-text">Track files</text>

  <!-- S3 Manifest Bucket -->
  <rect x="520" y="300" width="180" height="140" class="s3-box" rx="5"/>
  <text x="610" y="330" class="text">S3 Manifests</text>
  <text x="610" y="350" class="small-text" fill="#fff">ndjson-manifests-*</text>
  <text x="610" y="375" class="metric-text" fill="#fff">3,380 manifests/day</text>
  <text x="610" y="390" class="metric-text" fill="#fff">100 files each</text>
  <text x="610" y="405" class="metric-text" fill="#fff">JSON format</text>
  <text x="610" y="420" class="metric-text" fill="#fff">Date partitioned</text>

  <!-- Arrow from Lambda to Manifest -->
  <path d="M 250 340 L 280 340 L 280 360 L 520 360" class="data-arrow"/>
  <text x="360" y="355" class="small-text">Create manifest</text>

  <!-- Glue Batch Jobs -->
  <rect x="760" y="300" width="200" height="140" class="glue-box" rx="5"/>
  <text x="860" y="325" class="text">AWS Glue Jobs</text>
  <text x="860" y="345" class="small-text" fill="#fff">Batch Mode (glueetl)</text>
  <text x="860" y="370" class="metric-text" fill="#fff">Workers: 20 × G.2X</text>
  <text x="860" y="385" class="metric-text" fill="#fff">Concurrent: 30 jobs</text>
  <text x="860" y="400" class="metric-text" fill="#fff">Time: 7-10 min/job</text>
  <text x="860" y="415" class="metric-text" fill="#fff">PySpark processing</text>
  <text x="860" y="430" class="metric-text" fill="#fff">Snappy compression</text>

  <!-- Arrow from Manifest to Glue -->
  <path d="M 700 370 L 760 370" class="event-arrow"/>
  <text x="730" y="365" class="small-text">Trigger</text>

  <!-- Output Layer -->
  <text x="70" y="510" class="section-title">Output</text>

  <!-- S3 Output Bucket -->
  <rect x="1050" y="300" width="180" height="140" class="s3-box" rx="5"/>
  <text x="1140" y="330" class="text">S3 Output</text>
  <text x="1140" y="350" class="small-text" fill="#fff">ndjson-output-sqs-*</text>
  <text x="1140" y="375" class="metric-text" fill="#fff">Parquet format</text>
  <text x="1140" y="390" class="metric-text" fill="#fff">~2.1M files/day</text>
  <text x="1140" y="405" class="metric-text" fill="#fff">128 MB each</text>
  <text x="1140" y="420" class="metric-text" fill="#fff">190-270 TB/day</text>

  <!-- Arrow from Glue to Output -->
  <path d="M 960 370 L 1050 370" class="data-arrow"/>
  <text x="1005" y="365" class="small-text">Write Parquet</text>

  <!-- S3 Quarantine -->
  <rect x="1050" y="480" width="180" height="80" class="s3-box" rx="5"/>
  <text x="1140" y="510" class="text">S3 Quarantine</text>
  <text x="1140" y="530" class="small-text" fill="#fff">ndjson-quarantine-*</text>
  <text x="1140" y="545" class="metric-text" fill="#fff">Invalid files</text>

  <!-- Arrow from Lambda to Quarantine -->
  <path d="M 150 440 L 150 520 L 1050 520" class="arrow"/>
  <text x="450" y="515" class="small-text">Invalid size files</text>

  <!-- Monitoring Layer -->
  <text x="70" y="620" class="section-title">Monitoring</text>

  <!-- CloudWatch -->
  <rect x="50" y="640" width="300" height="100" class="cloudwatch-box" rx="5"/>
  <text x="200" y="670" class="text">CloudWatch</text>
  <text x="200" y="695" class="metric-text" fill="#fff">Logs: Lambda, Glue job runs</text>
  <text x="200" y="710" class="metric-text" fill="#fff">Metrics: Processing time, errors, costs</text>
  <text x="200" y="725" class="metric-text" fill="#fff">Alarms: High queue depth, job failures</text>

  <!-- DynamoDB Metrics -->
  <rect x="400" y="640" width="200" height="100" class="dynamo-box" rx="5"/>
  <text x="500" y="670" class="text">DynamoDB Metrics</text>
  <text x="500" y="695" class="metric-text" fill="#fff">File counts by status</text>
  <text x="500" y="710" class="metric-text" fill="#fff">Processing latency</text>
  <text x="500" y="725" class="metric-text" fill="#fff">Daily volume tracking</text>

  <!-- Monitoring arrows -->
  <path d="M 150 440 L 150 580 L 100 580 L 100 640" class="event-arrow"/>
  <path d="M 860 440 L 860 600 L 250 600 L 250 640" class="event-arrow"/>
  <path d="M 390 440 L 390 580 L 500 580 L 500 640" class="event-arrow"/>

  <!-- Key Metrics Box -->
  <rect x="650" y="640" width="320" height="100" class="box" rx="5"/>
  <text x="810" y="665" class="label" style="font-weight: bold;">Production Metrics</text>
  <text x="810" y="685" class="small-text">Daily Volume: 338K files (1.3 PB)</text>
  <text x="810" y="700" class="small-text">Processing Time: 9-15 hours/day</text>
  <text x="810" y="715" class="small-text">Success Rate: &gt;98%</text>
  <text x="810" y="730" class="small-text">Daily Cost: $2,500-$3,500</text>

  <!-- Configuration Box -->
  <rect x="1020" y="640" width="340" height="100" class="box" rx="5"/>
  <text x="1190" y="665" class="label" style="font-weight: bold;">Batch Configuration</text>
  <text x="1060" y="685" class="small-text" text-anchor="start">• Files/Manifest: 100 (file-count batching)</text>
  <text x="1060" y="700" class="small-text" text-anchor="start">• Max Batch Size: 500 GB (safety limit)</text>
  <text x="1060" y="715" class="small-text" text-anchor="start">• Concurrent Jobs: 30 (3,000 files parallel)</text>
  <text x="1060" y="730" class="small-text" text-anchor="start">• Workers/Job: 20 × G.2X (16GB RAM each)</text>

  <!-- Legend -->
  <text x="70" y="800" class="section-title">Legend</text>
  <path d="M 50 820 L 120 820" class="data-arrow"/>
  <text x="130" y="825" class="small-text">Data Flow</text>

  <path d="M 250 820 L 320 820" class="event-arrow"/>
  <text x="330" y="825" class="small-text">Event/Trigger</text>

  <path d="M 470 820 L 540 820" class="arrow"/>
  <text x="550" y="825" class="small-text">Control Flow</text>

  <!-- Service boxes in legend -->
  <rect x="720" y="810" width="60" height="20" class="s3-box" rx="2"/>
  <text x="750" y="824" class="small-text" fill="#fff">S3</text>

  <rect x="790" y="810" width="80" height="20" class="lambda-box" rx="2"/>
  <text x="830" y="824" class="small-text" fill="#fff">Lambda</text>

  <rect x="880" y="810" width="60" height="20" class="glue-box" rx="2"/>
  <text x="910" y="824" class="small-text" fill="#fff">Glue</text>

  <rect x="950" y="810" width="90" height="20" class="dynamo-box" rx="2"/>
  <text x="995" y="824" class="small-text" fill="#fff">DynamoDB</text>

  <rect x="1050" y="810" width="60" height="20" class="sqs-box" rx="2"/>
  <text x="1080" y="824" class="small-text" fill="#fff">SQS</text>

  <!-- Footer -->
  <text x="700" y="875" class="metric-text" text-anchor="middle">Architecture: Batch Processing | Mode: glueetl | Scale: 338K files/day @ 4GB | Compression: 5-7x (Snappy)</text>
</svg>
